<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Tilastotieteen harjoitustyö 2021</title>
    <link rel="stylesheet" href="./styles.css">
    <link rel="stylesheet" href="https://philarcher.org/css/numberheadings.css">

    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link
        href="https://fonts.googleapis.com/css2?family=Merriweather:ital,wght@0,300;0,400;0,700;0,900;1,300;1,400;1,700;1,900&display=swap"
        rel="stylesheet">
    <link
        href="https://fonts.googleapis.com/css2?family=Ubuntu:ital,wght@0,300;0,400;0,500;0,700;1,300;1,400;1,500;1,700&display=swap"
        rel="stylesheet">

    <link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/highlight.js/11.3.1/styles/default.min.css">
    <script src="//cdnjs.cloudflare.com/ajax/libs/highlight.js/11.3.1/highlight.min.js"></script>
</head>

<body>
    <main class="container">
        <h1 class="nocount">Tilastotieteen harjoitustyö 2021</h1>
        <strong>TILM3558</strong>
        <ul class="unstyled">
            <li>
                Marko Järvinen
            </li>
            <li>
                518467
            </li>
            <li>
                mabeja@utu.fi
            </li>
        </ul>
        <!-- ################## Numeeristen vastemuuttujien mallitus ############################## -->

        <h2>Numeeristen vastemuuttujien mallitus</h2>
        <strong>Satunnaisotos (700 otosta) valittu käyttämällä opiskelijanumeroa siemenlukuna</strong>

        <p>
            <code>elinolo.sav</code> (Tilastokeskuksen elinolotutkimuksen aineisto, N=2199)
        </p>
        <pre>
            <code class="language-r code">library(foreign)<br>
                ht1.dat <- read.spss("elinolo2020.sav", to.data.frame = TRUE)<br>
                attach(ht1.dat)<br>
                
                set.seed(518467)<br>
                oma.otos1 <- ht1.dat[sample(nrow(ht1.dat), 700),]<br>
                attach(oma.otos1)<br>
            </code>
        </pre>

        <!------------------------Varianssianalyysi ----------------------------->

        <h3>Varianssianalyysi</h3>
        <blockquote>
            Tutki, onko sukupuolella ja asumisahtaudella yhteyttä asunnon pinta-alaan.
        </blockquote>
        <p>
            Käytetään kaksisuuntaista varianssianalyysiä, koska kyseessä on yksi numeerinen selitettävä muuttuja
            ja kaksi kategorista selittävää muuttujaa.
        </p>
        <strong>Normaalijakaumaoletus</strong>
        <p>
            Jaetaan aineisto sukupuolen mukaan kahteen osaan:
        </p>
        <pre>
            <code class="language-r code">library(dplyr)<br>
                miehet.dat <- select(filter(oma.otos1, supu=="mies" ), c(supu, ahtas, pala))<br>
                naiset.dat <- select(filter(oma.otos1, supu=="nainen" ), c(supu, ahtas, pala))<br>
            </code>
        </pre>
        <p>
            Tehdään Shapiro-Wilk -testit:
        </p>
        <pre>
            <code class="language-r code">with(miehet.dat, tapply(pala, list(ahtas), shapiro.test))<br>
                with(naiset.dat, tapply(pala, list(ahtas), shapiro.test))<br>
            </code>
        </pre>
        <p>
            Testien tulosten perusteella kaikkien luokkien p-arvot eivät ylitä rajaa 0,5, joten
            normaalijakaumaoletus
            ei ole voimassa. Parametrista testiä voidaan kuitenkin käyttää havaintojen suuresta määrästä
            johtuen.
            Myöskin havainnoista luotujen laatikko-jana-kuvioiden perusteella ne ovat normaalisti jakautuneita.
        </p>
        <p>Tehdään kaksisuuntainen varianssianalyysi:</p>
        <pre>
            <code class="language-r code">attach(oma.otos1)<br>
                library(car)<br>
                leveneTest(pala~supu*ahtas)<br>
            </code>
        </pre>
        <p>
            Kaksisuuntaisen varianssianalyysin perusteella sekä sukupuoli, että asumisahtaus ovat
            tilastollisesti
            merkitseviä selittäjiä, sillä niiden F-testin p-arvot ovat alle
            0,001. Sen sijaan niiden yhdysvaikutuksen F-testin p-arvo on yli 0,001 eikä siksi ole
            tilastollisesti
            merkitsevä selittäjä.
        </p>

        <!------------------------ Regressiomalli ----------------------------->

        <h3>Regressiomalli</h3>
        <blockquote>
            Tutki, onko kotitalouden kuluttajayksiköiden lukumäärällä, asumismenoilla yhteensä ja
            alueella asumisajalla yhteyttä asunnon pinta-alaan.
        </blockquote>
        <p>
            Tehdään regressioanalyysi, jossa selittäjinä ovat kotitalouden kuluttajayksiköiden lukumäärä,
            asumismenot ja
            alueella asumisaika sekä selitettävänä asunnon pinta-ala.
        </p>
        <p>
            Tehdään sirontakuviot:
        </p>
        <pre>
            <code class="language-r code"># sirontakuvio, kotitalouden kuluttajayksiköiden lukumäärä<br>
                plot(rkyks, pala)<br>
                abline(lm(pala~rkyks))<br>
                
                # sirontakuvio, asumismenot<br>
                plot(asmenot, pala)<br>
                abline(lm(pala~asmenot))<br>
                
                # sirontakuvio, asumismenot<br>
                plot(alaika, pala)<br>
                abline(lm(pala~alaika))<br>
            </code>
        </pre>
        <p>
            Sirontakuvioista päätellen kotitalouden kuluttajayksiköiden lukumäärän, asumismenojen ja alueella
            asumisajan
            kasvaessa asunnon pinta-alakin kasvaa.
        </p>
        <p>
            Lasketaan Pearsonin ja Spearmanin korrelaatiokertoimet:
        </p>
        <pre>
            <code class="language-r code">cor.test(rkyks, pala, method="pearson")<br>
                cor.test(rkyks, pala, method="spearman", exact=FALSE)<br>
                cor.test(asmenot, pala, method="pearson")<br>
                cor.test(asmenot, pala, method="spearman", exact=FALSE)<br>
                cor.test(alaika, pala, method="pearson")<br>
                cor.test(alaika, pala, method="spearman", exact=FALSE)<br>
            </code>
        </pre>
        <p>
            Pearsonin korrelaatiokerroin kotitalouden kuluttajayksiköiden lukumäärän ja asunnon pinta-alalle on
            n.
            0,480, joka osoittaa merkittävää suoraviivaista riippuvaisuutta. Spearmanin kerroin on vastaavasti
            n. 0,555,
            joka myös osoittaa merkittävää suoraviivaista riippuvuutta.
        </p>
        <p>
            Pearsonin korrelaatiokerroin asumismenojen ja asunnon pinta-alalle on n. 0,088 ja Spearmanin kerroin
            on
            vastaavasti n. 0,029. Yhteyksiä näiden muuttujien välillä ei voida pitää suoraviivaisina.
        </p>
        <p>
            Pearsonin korrelaatiokerroin alueella asumisajan ja asunnon pinta-alalle on n. 0,107 ja Spearmanin
            kerroin
            on vastaavasti n. 0,200. Yhteydet näiden muuttujien välillä ovat suoraviivaisia.
        </p>
        <p>
            Kolmen selittäjän regressiomalli:
        </p>
        <pre>
            <code class="language-r code">lm.pala <- lm(pala~rkyks+asmenot+alaika)<br>
                summary(lm.pala)<br>
            </code>
        </pre>
        <p>
            Mallin regressioyhtälöksi saadaan 19,29 + 25,64 &sdot; kotitalouden kuluttajayksiköiden lukumäärä +
            0,00047
            &sdot; asumismenot+ 0,34 &sdot; alueella asumisaika = asunnon pinta-ala.
        </p>

        <!------------------------ Toistomittausmalli ----------------------------->

        <h3>Toistomittausmalli</h3>
        <strong>Satunnaisotos (600 otosta) valittu käyttämällä opiskelijanumeroa siemenlukuna</strong>
        <p>
            <code>Toistomittausaineisto2020.sav</code> (7 maasta kerätty aineisto potilaan ohjauksesta,
            N=1299)
        </p>
        <pre>
            <code class="language-r code">library(foreign)<br>    
                ht2.dat<-read.spss("Toistomittausaineisto2020.sav", to.data.frame=TRUE)<br>
                attach(ht2.dat)<br>
                
                set.seed(518467)<br>
                oma.otos2<-ht2.dat[sample(nrow(ht2.dat), 600), ]<br>
                attach(oma.otos2)<br>
            </code>
        </pre>
        <p>
            <i>
                Tutkijalla on hypoteesi, että potilaan mielestä saatu ohjaus leikkauksen jälkeen
                toiminnallista seikoista (<code>Functional_M2</code>) on ollut vähäisempää kuin odotettu ennen
                leikkausta (<code>Functional_M1</code>). Eli keskiarvo toisessa mittauksessa on matalampi.
                Lisäksi
                kiinnostaa se, onko tuo ero mittausten välillä erilainen sukupuolittain.
            </i>
        </p>

        <blockquote>
            Tutki saavatko nämä tutkimushypoteesit tukea mallittamalla aineisto toistettujen mittausten
            varianssianalyysillä.
        </blockquote>

        <strong>
            Molemmat sukupuolet
        </strong>
        <p>
            Suoritetaan toistettujen mittausten varianssianalyysi. Tarkistetaan ensin onko normaalijakaumaoletus
            voimassa Shapiro-Wilk -testeillä:
        </p>
        <pre>
            <code class="language-r code">shapiro.test(Functional_M2)<br>
                shapiro.test(Functional_M1)<br>
            </code>
        </pre>
        <p>
            Sekä <code>Functional_M2</code>:n ja <code>Functional_M1</code>:n p-arvot ovat alle 0,001. Tästä voidaan
            todeta, että normaalijakaumaoletus ei ole voimassa.
        </p>
        <p>
            Koska normaalijakaumaoletus ei ole voimassa, käytetään epäparametrista testiä.
        </p>
        <p>
            Järjestetään havainnot Friedmanin testiä varten:
        </p>
        <pre>
            <code class="language-r code">library(dplyr)<br>
                filtered_data <- na.omit(select(oma.otos2, patient, Functional_M1, Functional_M2, D2))<br>
                filtered_data <- with(filtered_data, filtered_data[order(patient), ])<br>
                filtered_data <- filtered_data[!duplicated(filtered_data$patient), ]<br>
                <br>
                M1_patient <- list(select(filtered_data, patient))<br>
                M1_value <- list(select(filtered_data, Functional_M1))<br>
                M1_Sex <- list(select(filtered_data, D2))<br>
                M1 <- do.call(rbind.data.frame, Map('c', M1_patient, M1_value, M1_Sex))<br>
                M1['Functional'] = 'M1'<br>
                names(M1)[names(M1) == 'Functional_M1'] <- 'Functional_Value'<br>
                <br>
                M2_patient <- list(select(filtered_data, patient))<br>
                M2_value <- list(select(filtered_data, Functional_M2))<br>
                M2_Sex <- list(select(filtered_data, D2))<br>
                M2 <- do.call(rbind.data.frame, Map('c', M2_patient, M2_value, M2_Sex))<br>
                M2['Functional'] = 'M2'<br>
                names(M2)[names(M2) == 'Functional_M2'] <- 'Functional_Value'<br>
                <br>
                data <- rbind(M1, M2)<br>
            </code>
        </pre>
        <p>
            Tehdään Friedmanin testi:
        </p>
        <pre>
            <code class="language-r code">attach(data)<br>
                friedman.test(Functional_Value ~ Functional | patient, data=data)<br>
                detach(data)<br>
            </code>
        </pre>
        <p>
            Friedmanin testin p-arvo on alle 0,001, joten muuttujien välillä on
            tilastollisesti merkitseviä eroja. Tehdään muuttujien välinen vertailu Wilcoxonin testillä:
        </p>
        <pre>
            <code class="language-r code">attach(oma.otos2)<br>
                wilcox.test(Functional_M1, Functional_M2, paired = TRUE)<br>
            </code>
        </pre>
        <p>
            Testin tuloksen mukaan muuttujien välinen ero on tilastollisesti merkitsevä, sillä
            testin p-arvo on alle 0,001.
        </p>

        <strong>
            Sukupuolet erikseen
        </strong>
        <div style="background-color: pink; color: rgb(255, 30, 30); padding: 10px;">

            <p>
                Tehdään normaalijakaumatestit:
            </p>
            <pre>
                <code class="language-r code">with(oma.otos2, tapply(Functional_M1, D2, shapiro.test))<br>
                    with(oma.otos2, tapply(Functional_M2, D2, shapiro.test))<br>
                </code>
            </pre>
            <p>
                Molempien testien tapauksessa p-arvo on alle 0,001, joten niiden normaalius ei toteudu.
            </p>

        </div>

        <p>
            Tehdään toistettujen mittausten varianssianalyysi, jossa luokitteleva
            tekijä on sukupuoli (<code>D2</code>).
        </p>
        <pre>
            <code class="language-r code">attach(data)<br>
                summary(aov(Functional_Value ~ D2 * Functional + Error(patient / Functional), data=data))<br>
                detach(data)<br>
            </code>
        </pre>
        <p>
            Tulosteesta huomataan, että sukupuolien välillä ei ole tilastollisesti
            merkitseviä eroja (p=0,628). Sen sijaan mittausten väliset erot ovat
            tilastollisesti merkitseviä (p&lt;0,001). Myöskään näiden välinen yhdysvaikutus
            ei ole tilastollisesti merkitsevää (p=0,642).
        </p>



        <!-- <i>
            Huom. Numeeristen vastemuuttujien mallituksessa on varianssianalyysien
            osalta tehtävä tarvittava kuvaileva tarkastelu ja regressiomallissa yhteyksien
            suoraviivaisuuksien tarkastelu ja jäännöstarkastelu.
        </i> -->

        <!-- ################## Kategoristen vastemuuttujien mallitus ############################## -->

        <h2>Kategoristen vastemuuttujien mallitus</h2>
        <strong>Satunnaisotos (900 otosta) valittu käyttämällä opiskelijanumeroa siemenlukuna</strong>
        <p>
            <code>EK2011.sav</code> (eduskuntavaaliaineisto vuodelta 2011, N=1318)
        </p>
        <pre>
            <code class="language-r code">koodia koodia ....<br>
            </code>
        </pre>

        <!------------------------ Muuttujien riippuvuusrakenne ----------------------------->

        <h3>Muuttujien riippuvuusrakenne</h3>
        <ol>
            <li>
                <p>
                    Tarkastellaan muuttujia sukupuoli (<code>d2</code>), työttömyys viimeisen 12 kuukauden
                    aikana
                    (<code>k32</code>) ja oman sukupuolen 2011 eduskuntavaaleissa äänestäminen
                    (<code>k23</code>). Tee
                    ensin
                    yksiulotteiset frekvenssijakaumat ja kolmen muuttujan ristiintaulu.
                </p>
                <blockquote>
                    Onko 3-ulotteisessa ristiintaulussa nollasoluja?
                </blockquote>
            </li>

            <li>
                <p>
                    Tarkastele kolmen muuttujan välisiä riippuvuuksia loglineaaristen mallien avulla. Ota
                    mukaan muuttujista vain ne luokat, joissa havaintoja on yli 10.
                </p>

                <blockquote>
                    Millaiset riippuvuudet muuttujien välillä askeltavan menetelmän avulla valittuun malliin
                    jäivät?
                </blockquote>

                <blockquote>
                    Mikä on mallin generoiva luokka?
                </blockquote>

                <blockquote>
                    Mikä on mallin yhteensopivuustestin p-arvo?
                </blockquote>

                <blockquote>
                    Mikä on standardoitujen jäännösten vaihteluväli?
                </blockquote>
            </li>

            <li>
                <p>
                    Tee mallin mukainen yhteyksien jatkotarkastelu ristiintauluin ja tulkitse malli
                    riviprosenttien avulla.
                </p>
            </li>
        </ol>

        <!------------------------ Kaksiluokkainen selitettävä muuttuja ----------------------------->

        <h3>Kaksiluokkainen selitettävä muuttuja</h3>
        <ol>
            <li>
                <p>
                    Tutki muuttujien sukupuoli (<code>d2</code>) ja ikä yhteyttä työttömyyteen viimeisen 12
                    kuukauden
                    aikana (<code>k32</code>) käyttämällä logistista regressiomallia.
                </p>
            </li>

            <li>
                <blockquote>
                    Mitkä muuttujat selittävät työttömyyttä ?
                </blockquote>

                <blockquote>
                    Tulkitse yhteydet OR:ien avulla. Raportoi myös luottamusvälit OR:ille
                </blockquote>

                <blockquote>
                    Mikä on mallin <i>Nagelkerke</i> selitysaste ?
                </blockquote>
            </li>
        </ol>

        <!-- ################## Monimuuttujamenetelmät ############################## -->

        <h2>Monimuuttujamenetelmät</h2>
        <strong>Satunnaisotos (1500 otosta) valittu käyttämällä opiskelijanumeroa siemenlukuna</strong>
        <p>
            <code>pankkiotos2020.sav</code> (todellinen asiakasaineisto, N=2453)
        </p>
        <pre>
            <code class="language-r code">koodia koodia ....<br>
            </code>
        </pre>

        <!------------------------ Muuttujien ryhmittely ----------------------------->

        <h3>Muuttujien ryhmittely</h3>
        <ol>
            <li>
                <p>
                    Muodosta pääkomponenttianalyysilla luokitelluista muuttujista (41 kpl:
                    <code>autom_lainan_perinta_luok -
                        kulutusluotot1_luok</code>) pääkomponentteja ominaisarvokriteerin
                    mukaan. (Promax-rotaatio)
                </p>
            </li>

            <li>
                <p>
                    Talleta havaintomatriisiin uusiksi muuttujiksi pääkomponenttipistemäärät.
                </p>
            </li>

            <li>
                <p>
                    Nimeä uudet muuttujat (pääkomponentteihin latautuneiden muuttujien mukaisesti).
                </p>
            </li>
        </ol>

        <!------------------------ Havaintojen ryhmittely ----------------------------->

        <h4>Havaintojen ryhmittely</h4>
        <ol start="4">
            <li>
                <p>
                    Käytä näitä uusia muuttujia klusterianalyysissä, jossa muodostat asiakasryhmiä K-means
                    menetelmällä lähtien kahdesta klusterista viiteen tai kuuteen klusteriin saakka. Kuvaile
                    muodostamiasi ryhmiä.
                </p>
            </li>
        </ol>

    </main>
    <script>
        hljs.highlightAll();
    </script>
</body>

</html>